<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Movie</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'zinc': {
              900: '#18181b'
            }
          }
        }
      },
    }
  </script>
  <style>
    body {
      min-height: 100vh;
      background-color: #18181b;
    }
    .bg-overlay::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(24, 24, 27, 0.85);
      backdrop-filter: blur(10px);
      z-index: 0;
      pointer-events: none;
    }
  </style>
</head>
<body class="dark relative min-h-screen text-white">

  <div class="bg-overlay fixed inset-0 -z-10">
    <img src="/static/background.png" alt="" class="w-full h-full object-cover object-center fixed inset-0 -z-20 select-none pointer-events-none" draggable="false" />
  </div>

  <div class="container mx-auto max-w-xl w-full px-6 py-8 rounded-xl flex flex-col items-center justify-center bg-transparent relative z-10 mt-0">
    <div class="header mb-2 flex flex-row items-center">
      <h1 class="text-4xl md:text-4xl font-bold text-white select-none mr-2">Find your</h1>
      <h1 class="text-4xl md:text-4xl font-bold bg-gradient-to-r from-violet-500 to-purple-400 bg-clip-text text-transparent select-note">Movie</h1>
    </div>

    <form id="randomForm" class="flex flex-col gap-3 w-full max-w-md mt-5">
      <div class="flex flex-row items-center gap-2 justify-center relative">
        <button type="submit" class="group duration-500 before:duration-500 after:duration-500 hover:duration-500 relative h-16 w-64 border border-zinc-400 text-left p-3 text-gray-50 text-base font-bold rounded-lg overflow-hidden before:absolute before:w-12 before:h-12 before:content[''] before:right-1 before:top-1 before:z-10 before:bg-violet-500 before:rounded-full before:blur-lg after:absolute after:z-10 after:w-20 after:h-20 after:content[''] after:bg-violet-500 after:right-8 after:top-3 after:rounded-full after:blur-lg hover:before:[box-shadow:_20px_20px_20px_30px_#8b5cf6] hover:after:-right-8 hover:before:right-12 hover:before:-bottom-8 hover:before:blur origin-left hover:decoration-2 flex items-center justify-center">
          <span class="relative z-20">Get a random movie</span>
        </button>
        <button type="button" id="settingsBtn" class="ml-2 p-2 rounded-full hover:bg-zinc-800 transition flex items-center justify-center" aria-label="Select library">
          <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" class="w-6 h-6 text-zinc-400 hover:text-violet-500 transition">
            <path fill="currentColor" d="M19.9 12.66a1 1 0 0 1 0-1.32l1.28-1.44a1 1 0 0 0 .12-1.17l-2-3.46a1 1 0 0 0-1.07-.48l-1.88.38a1 1 0 0 1-1.15-.66l-.61-1.83a1 1 0 0 0-.95-.68h-4a1 1 0 0 0-1 .68l-.56 1.83a1 1 0 0 1-1.15.66L5 4.79a1 1 0 0 0-1 .48L2 8.73a1 1 0 0 0 .1 1.17l1.27 1.44a1 1 0 0 1 0 1.32L2.1 14.1a1 1 0 0 0-.1 1.17l2 3.46a1 1 0 0 0 1.07.48l1.88-.38a1 1 0 0 1 1.15.66l.61 1.83a1 1 0 0 0 1 .68h4a1 1 0 0 0 .95-.68l.61-1.83a1 1 0 0 1 1.15-.66l1.88.38a1 1 0 0 0 1.07-.48l2-3.46a1 1 0 0 0-.12-1.17ZM18.41 14l.8.9l-1.28 2.22l-1.18-.24a3 3 0 0 0-3.45 2L12.92 20h-2.56L10 18.86a3 3 0 0 0-3.45-2l-1.18.24l-1.3-2.21l.8-.9a3 3 0 0 0 0-4l-.8-.9l1.28-2.2l1.18.24a3 3 0 0 0 3.45-2L10.36 4h2.56l.38 1.14a3 3 0 0 0 3.45 2l1.18-.24l1.28 2.22l-.8.9a3 3 0 0 0 0 3.98m-6.77-6a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 6a2 2 0 1 1 2-2a2 2 0 0 1-2 2"/>
          </svg>
        </button>
        <div id="libraryDropdown" class="absolute right-0 top-16 mt-2 border rounded-lg shadow-lg p-3 z-30 min-w-[200px] hidden backdrop-blur-md">
          <label for="librarySelect" class="block text-sm font-medium mb-2 text-zinc-300">Select Library</label>
          <select name="library" id="librarySelect" class="w-full px-3 py-2 rounded-md border border-zinc-700 bg-zinc-800 text-inherit focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
            {{range .Libraries}}
              <option value="{{.Id}}">{{.Name}}</option>
            {{end}}
          </select>
        </div>
      </div>
    </form>
    <script>
      const settingsBtn = document.getElementById('settingsBtn');
      const libraryDropdown = document.getElementById('libraryDropdown');
      document.addEventListener('click', function(e) {
        if (settingsBtn.contains(e.target)) {
          libraryDropdown.classList.toggle('hidden');
        } else if (!libraryDropdown.contains(e.target)) {
          libraryDropdown.classList.add('hidden');
        }
      });
    </script>

    <div id="result-container" class="w-full flex flex-col items-center justify-start mt-4 h-[700px] rounded-lg p-5 bg-transparent overflow-hidden">
      <div id="loader" class="hidden flex-col items-center justify-center w-full h-full">
        <svg viewBox="25 25 50 50" class="w-16 h-16 animate-spin">
          <circle r="20" cy="50" cx="50" fill="none" stroke="#8b5cf6" stroke-width="4" stroke-dasharray="90,200" stroke-linecap="round"></circle>
        </svg>
      </div>
      <div id="result" class="w-full"></div>
    </div>
  </div>

  <script>
    function formatDuration(minutes) {
      if (!minutes || isNaN(minutes)) return 'N/A';
      const h = Math.floor(minutes / 60);
      const m = minutes % 60;
      if (h > 0 && m > 0) {
        return `${h} h ${m.toString().padStart(2, '0')}`;
      } else if (h > 0) {
        return `${h} h`;
      } else {
        return `${m} min `;
      }
    }

    document.getElementById("randomForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const libId = document.getElementById("librarySelect").value;
      const loader = document.getElementById("loader");
      const resultDiv = document.getElementById("result");

      loader.classList.remove("hidden");
      loader.classList.add("flex");
      resultDiv.innerHTML = "";

      fetch("/random?library=" + libId)
        .then(resp => {
          if (!resp.ok) throw new Error("Erreur");
          return resp.json();
        })
        .then(data => {
          loader.classList.add("hidden");
          loader.classList.remove("flex");
          
          resultDiv.innerHTML = `
            <div class="movie-item flex flex-col items-center w-full max-w-lg mx-auto bg-transparent rounded-xl p-0 text-center">
              <h2 class="text-2xl md:text-3xl font-bold my-3 break-words">${data.name}</h2>
              
              <a href="${data.jellyfinUrl}" target="_blank" class="movie-img-bg relative w-72 max-w-full h-[450px] rounded-xl mb-4 bg-zinc-800 shadow block overflow-hidden group cursor-pointer">
                <img src="${data.imageUrl}" alt="${data.name}" class="w-full h-full object-cover object-top rounded-xl transition-transform duration-300 group-hover:scale-105" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDIwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTUwIiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiPkltYWdlIG5vbiBkaXNwb25pYmxlPC90ZXh0Pgo8L3N2Zz4K'">
                
                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 backdrop-blur-sm"></div>
                
                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  <span class="text-white text-2xl font-bold drop-shadow-lg">See Now</span>
                </div>
              </a>
              
              <div class="movie-meta flex justify-between text-lg text-zinc-300 my-4 w-2/3 md:w-1/2">
                <div class="text-left">${data.year || 'N/A'} - ${formatDuration(data.duration)}</div>
                <div class="text-right flex items-center justify-end gap-2">
                  <span class="inline-block align-middle w-6 h-6">
                    <svg xmlns="http://www.w3.org/2000/svg"
                      aria-label="IMDb" role="img"
                      viewBox="0 0 512 512" width="24" height="24">
                      <rect width="512" height="512" rx="15%" fill="#f5c518"/>
                      <path d="M104 328V184H64v144zM189 184l-9 67-5-36-5-31h-50v144h34v-95l14 95h25l13-97v97h34V184zM256 328V184h62c15 0 26 11 26 25v94c0 14-11 25-26 25zm47-118l-9-1v94c5 0 9-1 10-3 2-2 2-8 2-18v-56-12l-3-4zM419 220h3c14 0 26 11 26 25v58c0 14-12 25-26 25h-3c-8 0-16-4-21-11l-2 9h-36V184h38v46c5-6 13-10 21-10zm-8 70v-34l-1-11c-1-2-4-3-6-3s-5 1-6 3v57c1 2 4 3 6 3s6-1 6-3l1-12z"/>
                    </svg>
                  </span>
                  <span class="font-bold">${data.rating ? data.rating.toFixed(1) : 'N/A'}</span>
                </div>
              </div>
            </div>
          `;
        })
        .catch(err => {
          loader.classList.add("hidden");
          loader.classList.remove("flex");
          resultDiv.innerHTML = `<p class="text-red-500 text-center font-semibold mt-4">Erreur : ${err.message}</p>`;
        });
    });
  </script>

</body>
</html>
